data class DetectionStatisticsResults(val truePositive: Int, val trueNegative: Int, val falsePositive: Int, val falseNegative: Int)

class DataValidator(val set:List<BaseApp>, private val learner: DataLearner.MalwareLearner) {
    fun validateDetection () : DetectionStatisticsResults {
        return if (learner is DataLearner.MalwareLearner) validateMalwareDetection() else return DetectionStatisticsResults(-1,-1,-1,-1)
    }

    fun validateClassification ()  {
        return if (learner is DataLearner.MalwareLearner) validateMalwareClassification() else return
    }

    private fun validateMalwareDetection() : DetectionStatisticsResults{
        var tp = 0
        var tn = 0
        var fp = 0
        var fn = 0
        for (element in set) {
            val result = learner.classify(element)
            if (result != "genuine" && element.isMalware) tp++
            else if (result == "genuine" && element.isMalware) fn++
            else if (result != "genuine" && !element.isMalware) fp++
            else if (result == "genuine" && !element.isMalware) tn++
        }
        println("tp ${tp}")
        println("tn ${tn}")
        println("fp ${fp}")
        println("fn ${fn}")
        println("Precision ${(tp.toFloat() /(tp+fp).toFloat())}")
        println("Recall ${(tp.toFloat()/(tp+fn).toFloat())}")
        println("False positive rate ${(fp.toFloat()/(fp+tn).toFloat())}")
        println("Accuracy ${((tp+tn).toFloat()/(fp+tn+fn+fp).toFloat())}")
        return DetectionStatisticsResults(tp,tn,fp,fn)
    }

    private fun validateMalwareClassification() {
        var trueMalwareType = 0
        var falseMalwareType = 0
        var trueGenuine = 0
        var trueMalware = 0
        var falseGenuine = 0
        var falseMalware = 0
        for (element in set) {
            val result = learner.classify(element)
            if (result != "genuine" && element.isMalware) {
                trueMalware++
                if (result == element.type) trueMalwareType++
                else falseMalwareType
            }
            else if (result == "genuine" && element.isMalware) falseGenuine++
            else if (result != "genuine" && !element.isMalware) falseMalware++
            else if (result == "genuine" && !element.isMalware) trueGenuine++
        }
        println("trueMalware ${trueMalware}")
        println("trueMalwareType ${trueMalwareType}")
        println("falseMalwareType ${falseMalwareType}")
        println("trueGenuine ${trueGenuine}")
        println("falseMalware ${falseMalware}")
        println("falseGenuine ${falseGenuine}")
    }

}